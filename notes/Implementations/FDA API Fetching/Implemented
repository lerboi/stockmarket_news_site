Based on your codebase, here's a comprehensive summary of your FDA data fetching architecture:

## ğŸ“Š **FDA Data Pipeline Overview**

### **ğŸ”„ Core Process Flow:**
1. **Fetch** â†’ 2. **Filter** â†’ 3. **Ingest** â†’ 4. **Analyze** â†’ 5. **Publish**

---

## ğŸ“ **API Route Files**

### **1. Individual FDA Data Sources**
- **`/api/fda/drug-approvals/route.js`**
  - Fetches FDA drug approvals from `api.fda.gov/drug/drugsfda.json`
  - Filters for approved submissions (`AP` status)
  - Returns transformed drug approval data

- **`/api/fda/safety-alerts/route.js`**
  - Fetches FDA safety alerts/recalls from `api.fda.gov/drug/enforcement.json`
  - Gets recall information with classifications (Class I, II, III)
  - Returns safety alert data

- **`/api/fda/device-approvals/route.js`**
  - Fetches FDA device clearances from `api.fda.gov/device/510k.json`
  - Gets 510(k) medical device approvals
  - Returns device approval data

### **2. Aggregation & Processing**
- **`/api/fda/all/route.js`**
  - **Aggregates** all three FDA data sources
  - Combines drugs, safety alerts, and devices
  - Sorts by date and applies limits

- **`/api/fda/ingest/route.js`** â­ **CORE INGESTION**
  - **AI-powered public company filtering**
  - Calls `/api/fda/all` to get raw FDA data
  - Uses **Claude AI** to identify only publicly traded companies
  - Saves filtered data to `fda_announcements` table
  - Adds items to `processing_queue` for AI analysis

- **`/api/fda/process/route.js`** â­ **AI ANALYSIS ENGINE**
  - **Batch AI processing** (4 items at a time)
  - Uses **Claude AI** for sentiment analysis
  - Generates stock tickers, exchanges, sentiment scores
  - Saves results to `processed_news` table
  - Marks queue items as completed

### **3. Data Serving**
- **`/api/news/route.js`**
  - **Public API** for dashboard consumption
  - Joins `processed_news` + `fda_announcements`
  - Applies filters (priority, sentiment, timeframe)
  - Returns formatted news for frontend

- **`/api/stats/route.js`**
  - **Dashboard metrics** and statistics
  - Queue status, processing counts, trends

### **4. Pipeline Control**
- **`/api/admin/trigger-pipeline/route.js`** â­ **ORCHESTRATOR**
  - **Master control** for the entire pipeline
  - Can run full pipeline or individual steps
  - Calls ingest â†’ process in sequence
  - Returns comprehensive results

---

## ğŸ¯ **Key Processes**

### **Process 1: Public Company Filtering (AI)**
```
Raw FDA Data â†’ Claude AI â†’ Only Public Companies â†’ Database
```
- **Location**: `/api/fda/ingest/route.js`
- **Function**: `filterPublicCompanies()`, `aiFilterCompanyBatch()`
- **Purpose**: Eliminates universities, government, private companies

### **Process 2: Sentiment Analysis (AI)**
```
Public Companies â†’ Claude AI â†’ Sentiment + Tickers â†’ Published News
```
- **Location**: `/api/fda/process/route.js`
- **Function**: `batchAnalyzeWithClaude()`, `buildEnhancedBatchPrompt()`
- **Purpose**: Generates trading intelligence with sentiment analysis

### **Process 3: Data Transformation**
```
FDA Raw Format â†’ Standardized Format â†’ Database Schema
```
- **Functions**: `generateTitle()`, `generateDescription()`, `parseAnnouncementDate()`
- **Purpose**: Converts FDA's inconsistent formats into clean, usable data

---

## ğŸ—„ï¸ **Database Tables Used**

1. **`fda_announcements`** - Raw FDA data (public companies only)
2. **`processing_queue`** - AI processing workflow management  
3. **`processed_news`** - AI-analyzed news ready for publication
4. **`users`** - Authentication

---

## ğŸš€ **External Dependencies**

### **FDA APIs**
- `api.fda.gov/drug/drugsfda.json` - Drug approvals
- `api.fda.gov/drug/enforcement.json` - Safety alerts/recalls
- `api.fda.gov/device/510k.json` - Device clearances

### **AI Service**
- **Anthropic Claude Sonnet 4** - Both filtering and sentiment analysis
- **Rate limiting**: 1-second delays between batches
- **Batch processing**: Max 4 items per Claude call

---

## âš¡ **Pipeline Trigger Methods**

### **Automatic**: 
- Currently manual only

### **Manual**:
```javascript
// Full pipeline
POST /api/admin/trigger-pipeline
{ "action": "full", "limit": 25 }

// Individual steps
POST /api/admin/trigger-pipeline  
{ "action": "ingest", "limit": 50 }

POST /api/admin/trigger-pipeline
{ "action": "process", "limit": 12 }
```

---

## ğŸ“ˆ **Data Flow Summary**
```
FDA APIs â†’ Raw Data â†’ AI Filter â†’ Public Companies DB â†’ 
AI Analysis â†’ Sentiment + Tickers â†’ Published News â†’ Dashboard
```

This architecture efficiently processes thousands of FDA announcements daily, filtering down to only the most relevant trading opportunities for penny stock investors with AI-powered sentiment analysis.